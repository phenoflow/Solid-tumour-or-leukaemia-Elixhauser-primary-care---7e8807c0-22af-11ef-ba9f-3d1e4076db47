# David Metcalfe, James Masters, Antonella Delmestri, Andrew Judge, Daniel Perry, Cheryl Zogg, Belinda Gabbe, Matthew Costa, 2024.

import sys, csv, re

codes = [{"code":"B48yz00","system":"readv2"},{"code":"B34yz00","system":"readv2"},{"code":"B302z00","system":"readv2"},{"code":"B150z00","system":"readv2"},{"code":"B801z00","system":"readv2"},{"code":"BBLH.00","system":"readv2"},{"code":"B822z00","system":"readv2"},{"code":"B4A1z00","system":"readv2"},{"code":"B450z00","system":"readv2"},{"code":"B6z0.00","system":"readv2"},{"code":"B064z00","system":"readv2"},{"code":"B0zz.00","system":"readv2"},{"code":"B151z00","system":"readv2"},{"code":"BB4z.00","system":"readv2"},{"code":"BBV..11","system":"readv2"},{"code":"B35zz00","system":"readv2"},{"code":"BBEz.00","system":"readv2"},{"code":"BBV1.11","system":"readv2"},{"code":"B512z00","system":"readv2"},{"code":"BB85z00","system":"readv2"},{"code":"B8z..00","system":"readv2"},{"code":"BB5jz00","system":"readv2"},{"code":"B213z00","system":"readv2"},{"code":"BB9M.00","system":"readv2"},{"code":"B060z00","system":"readv2"},{"code":"BBF6.00","system":"readv2"},{"code":"B521z00","system":"readv2"},{"code":"BB80100","system":"readv2"},{"code":"BBW4.00","system":"readv2"},{"code":"BBN5.00","system":"readv2"},{"code":"BBJ1.00","system":"readv2"},{"code":"B517z00","system":"readv2"},{"code":"B001z00","system":"readv2"},{"code":"B806.00","system":"readv2"},{"code":"BB90.00","system":"readv2"},{"code":"BBF1.00","system":"readv2"},{"code":"BBF3.00","system":"readv2"},{"code":"B110z00","system":"readv2"},{"code":"B59zX00","system":"readv2"},{"code":"BB5Dz00","system":"readv2"},{"code":"BB5D500","system":"readv2"},{"code":"B22z.00","system":"readv2"},{"code":"BB69z00","system":"readv2"},{"code":"B47z.00","system":"readv2"},{"code":"B340z00","system":"readv2"},{"code":"B523z00","system":"readv2"},{"code":"BB18.00","system":"readv2"},{"code":"B10z.00","system":"readv2"},{"code":"B550200","system":"readv2"},{"code":"B6z..00","system":"readv2"},{"code":"B332z00","system":"readv2"},{"code":"B306z00","system":"readv2"},{"code":"B804z00","system":"readv2"},{"code":"B500z00","system":"readv2"},{"code":"B327z00","system":"readv2"},{"code":"B826z00","system":"readv2"},{"code":"B33z.00","system":"readv2"},{"code":"BB5cz00","system":"readv2"},{"code":"BBF..00","system":"readv2"},{"code":"B224z00","system":"readv2"},{"code":"B31z000","system":"readv2"},{"code":"BBF5.11","system":"readv2"},{"code":"B550300","system":"readv2"},{"code":"B073z00","system":"readv2"},{"code":"BBE1.13","system":"readv2"},{"code":"B01z.00","system":"readv2"},{"code":"BB29.12","system":"readv2"},{"code":"B43z.00","system":"readv2"},{"code":"B111z00","system":"readv2"},{"code":"BBF2.00","system":"readv2"},{"code":"BB17.00","system":"readv2"},{"code":"BBQ7200","system":"readv2"},{"code":"B551100","system":"readv2"},{"code":"B430z00","system":"readv2"},{"code":"B554.00","system":"readv2"},{"code":"B11yz00","system":"readv2"},{"code":"BB5T100","system":"readv2"},{"code":"B010z00","system":"readv2"},{"code":"B24z.00","system":"readv2"},{"code":"B810z00","system":"readv2"},{"code":"B221z00","system":"readv2"},{"code":"B324z00","system":"readv2"},{"code":"BB5Wz00","system":"readv2"},{"code":"BBrA312","system":"readv2"},{"code":"B802z00","system":"readv2"},{"code":"BB2A.00","system":"readv2"},{"code":"B555.00","system":"readv2"},{"code":"B550500","system":"readv2"},{"code":"B180z00","system":"readv2"},{"code":"B5z..00","system":"readv2"},{"code":"B807z00","system":"readv2"},{"code":"B011z00","system":"readv2"},{"code":"B06z.00","system":"readv2"},{"code":"B812z00","system":"readv2"},{"code":"B072z00","system":"readv2"},{"code":"B51yz00","system":"readv2"},{"code":"B334z00","system":"readv2"},{"code":"BBE1.00","system":"readv2"},{"code":"B827z00","system":"readv2"},{"code":"B223z00","system":"readv2"},{"code":"BBG1.00","system":"readv2"},{"code":"BBL9.00","system":"readv2"},{"code":"B44z.00","system":"readv2"},{"code":"B000z00","system":"readv2"},{"code":"BBV1.00","system":"readv2"},{"code":"BBE1.12","system":"readv2"},{"code":"BB11.11","system":"readv2"},{"code":"B222z00","system":"readv2"},{"code":"B300z00","system":"readv2"},{"code":"B326z00","system":"readv2"},{"code":"BBN2.00","system":"readv2"},{"code":"B003z00","system":"readv2"},{"code":"BB5Tz00","system":"readv2"},{"code":"B82z.00","system":"readv2"},{"code":"B83z.00","system":"readv2"},{"code":"BB5Bz00","system":"readv2"},{"code":"BBF5.00","system":"readv2"},{"code":"BBM8.00","system":"readv2"},{"code":"BBF4.00","system":"readv2"},{"code":"BBN4.00","system":"readv2"},{"code":"BBN1.00","system":"readv2"},{"code":"B16z.00","system":"readv2"},{"code":"B41yz00","system":"readv2"},{"code":"B545z00","system":"readv2"},{"code":"B55yz00","system":"readv2"},{"code":"B13z.00","system":"readv2"},{"code":"B551z00","system":"readv2"},{"code":"B04z.00","system":"readv2"},{"code":"BB5Lz00","system":"readv2"},{"code":"BBd2.11","system":"readv2"},{"code":"B33z000","system":"readv2"},{"code":"B241z00","system":"readv2"},{"code":"B825100","system":"readv2"},{"code":"BBQ3.00","system":"readv2"},{"code":"B161z00","system":"readv2"},{"code":"BBVz.00","system":"readv2"},{"code":"BB81200","system":"readv2"},{"code":"B220z00","system":"readv2"},{"code":"BB2C.00","system":"readv2"},{"code":"B550400","system":"readv2"},{"code":"B81z.00","system":"readv2"},{"code":"Byu5300","system":"readv2"},{"code":"BB9B.00","system":"readv2"},{"code":"B553000","system":"readv2"},{"code":"BB80z00","system":"readv2"},{"code":"B825z00","system":"readv2"},{"code":"B11z.00","system":"readv2"},{"code":"BB52.00","system":"readv2"},{"code":"BBLJ.00","system":"readv2"},{"code":"B18yz00","system":"readv2"},{"code":"BB5Cz00","system":"readv2"},{"code":"BB82z00","system":"readv2"},{"code":"BB91.11","system":"readv2"},{"code":"B013z00","system":"readv2"},{"code":"B215.00","system":"readv2"},{"code":"B34z.00","system":"readv2"},{"code":"BBFz.00","system":"readv2"},{"code":"B501z00","system":"readv2"},{"code":"BBV1.13","system":"readv2"},{"code":"B550000","system":"readv2"},{"code":"B510z00","system":"readv2"},{"code":"B21z.00","system":"readv2"},{"code":"B551000","system":"readv2"},{"code":"BBY0.00","system":"readv2"},{"code":"B54z.00","system":"readv2"},{"code":"B333z00","system":"readv2"},{"code":"B12z.00","system":"readv2"},{"code":"B336z00","system":"readv2"},{"code":"BB1J.00","system":"readv2"},{"code":"B055z00","system":"readv2"},{"code":"BBgJ.11","system":"readv2"},{"code":"BB5z.00","system":"readv2"},{"code":"BB5Nz00","system":"readv2"},{"code":"B308z00","system":"readv2"},{"code":"BBLD.00","system":"readv2"},{"code":"B17z.00","system":"readv2"},{"code":"B551200","system":"readv2"},{"code":"BBK0200","system":"readv2"},{"code":"B55y200","system":"readv2"},{"code":"B50z.00","system":"readv2"},{"code":"B200z00","system":"readv2"},{"code":"BB9F.00","system":"readv2"},{"code":"B49z.00","system":"readv2"},{"code":"BBF4.11","system":"readv2"},{"code":"BB62z00","system":"readv2"},{"code":"BB43.00","system":"readv2"},{"code":"BB81500","system":"readv2"},{"code":"B55y100","system":"readv2"},{"code":"BBGM.00","system":"readv2"},{"code":"B81yz00","system":"readv2"},{"code":"B550z00","system":"readv2"},{"code":"BB5fz00","system":"readv2"},{"code":"BB5Xz00","system":"readv2"},{"code":"BB22.00","system":"readv2"},{"code":"B542z00","system":"readv2"},{"code":"BB2A.13","system":"readv2"},{"code":"B00zz00","system":"readv2"},{"code":"BB11.00","system":"readv2"},{"code":"BB5Uz00","system":"readv2"},{"code":"B062z00","system":"readv2"},{"code":"B553z00","system":"readv2"},{"code":"B653100","system":"readv2"},{"code":"B20z.00","system":"readv2"},{"code":"B55y000","system":"readv2"},{"code":"BB24.00","system":"readv2"},{"code":"B23z.00","system":"readv2"},{"code":"B08z.00","system":"readv2"},{"code":"B1zz.00","system":"readv2"},{"code":"BB5f100","system":"readv2"},{"code":"B2zz.00","system":"readv2"},{"code":"B3z..00","system":"readv2"},{"code":"B06yz00","system":"readv2"},{"code":"B323z00","system":"readv2"},{"code":"B305z00","system":"readv2"},{"code":"BB31.00","system":"readv2"},{"code":"B335z00","system":"readv2"},{"code":"BBEQ.00","system":"readv2"},{"code":"B803z00","system":"readv2"},{"code":"B48z.00","system":"readv2"},{"code":"BBK3100","system":"readv2"},{"code":"B520z00","system":"readv2"},{"code":"B41z.00","system":"readv2"},{"code":"BB12.00","system":"readv2"},{"code":"BB93.00","system":"readv2"},{"code":"B52z.00","system":"readv2"},{"code":"B07z.00","system":"readv2"},{"code":"B51z.00","system":"readv2"},{"code":"B322z00","system":"readv2"},{"code":"B470z00","system":"readv2"},{"code":"B303z00","system":"readv2"},{"code":"BBDB.11","system":"readv2"},{"code":"BB5Mz00","system":"readv2"},{"code":"BBLE.00","system":"readv2"},{"code":"B18z.00","system":"readv2"},{"code":"BBX1.11","system":"readv2"},{"code":"B410z00","system":"readv2"},{"code":"BB2A.11","system":"readv2"},{"code":"BBL7111","system":"readv2"},{"code":"BB5X100","system":"readv2"},{"code":"BB5Vz00","system":"readv2"},{"code":"B8yyz00","system":"readv2"},{"code":"B808z00","system":"readv2"},{"code":"B14z.00","system":"readv2"},{"code":"B31z.00","system":"readv2"},{"code":"B17yz00","system":"readv2"},{"code":"B05z000","system":"readv2"},{"code":"B05z.00","system":"readv2"},{"code":"BBK2z00","system":"readv2"},{"code":"B592X00","system":"readv2"},{"code":"BBL4.00","system":"readv2"},{"code":"B33z.11","system":"readv2"},{"code":"B1z1z00","system":"readv2"},{"code":"B337z00","system":"readv2"},{"code":"BBY0.11","system":"readv2"},{"code":"B15z.00","system":"readv2"},{"code":"BB5az00","system":"readv2"},{"code":"BBd2.12","system":"readv2"},{"code":"BBV..13","system":"readv2"},{"code":"BB19.00","system":"readv2"},{"code":"B002z00","system":"readv2"},{"code":"B02z.00","system":"readv2"},{"code":"B30z.00","system":"readv2"},{"code":"B03z.00","system":"readv2"},{"code":"B550100","system":"readv2"},{"code":"B431z00","system":"readv2"},{"code":"B325z00","system":"readv2"},{"code":"B4Az.00","system":"readv2"},{"code":"BB5P.00","system":"readv2"},{"code":"B55z.00","system":"readv2"},{"code":"B071z00","system":"readv2"},{"code":"BB81E00","system":"readv2"},{"code":"B3...12","system":"readv2"},{"code":"B800z00","system":"readv2"},{"code":"B540z00","system":"readv2"},{"code":"B4z..00","system":"readv2"},{"code":"B307z00","system":"readv2"},{"code":"B32z.00","system":"readv2"},{"code":"B451z00","system":"readv2"},{"code":"B59z.00","system":"readv2"},{"code":"BBf..00","system":"readv2"},{"code":"BB5Sz00","system":"readv2"},{"code":"BB29.00","system":"readv2"},{"code":"Byu5B00","system":"readv2"},{"code":"BBL0.00","system":"readv2"},{"code":"B833z00","system":"readv2"},{"code":"BBf2.00","system":"readv2"},{"code":"B471z00","system":"readv2"},{"code":"BBTA.00","system":"readv2"},{"code":"B45z.00","system":"readv2"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('solid-tumour-or-leukaemia-elixhauser-primary-care-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["solid-tumour-or-leukaemia-elixhauser-primary-care-madenosarcoma---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["solid-tumour-or-leukaemia-elixhauser-primary-care-madenosarcoma---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["solid-tumour-or-leukaemia-elixhauser-primary-care-madenosarcoma---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
